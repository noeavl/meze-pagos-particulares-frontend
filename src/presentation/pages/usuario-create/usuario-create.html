<div class="max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Crear Usuario</h1>
        <p class="text-gray-600 text-sm mt-1">Agregar un nuevo usuario al sistema</p>
      </div>
      <button
        [routerLink]="['/usuarios']"
        pButton
        type="button"
        label="Volver"
        icon="pi pi-arrow-left"
        severity="secondary"
      ></button>
    </div>
  </div>

  <!-- Form -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <form [formGroup]="usuarioForm" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 gap-6">
        
        <!-- Nombre -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Nombre *
          </label>
          <input
            type="text"
            pInputText
            formControlName="name"
            placeholder="Ingrese el nombre completo"
            class="w-full"
            [class.ng-invalid]="(usuarioForm.get('name')?.invalid && usuarioForm.get('name')?.touched) || validationErrors?.['name']"
          />
          @if ((usuarioForm.get('name')?.invalid && usuarioForm.get('name')?.touched) || validationErrors?.['name']) {
            <small class="text-red-500 text-sm mt-1 block">
              @if (validationErrors?.['name']) {
                @for (error of validationErrors!['name']; track error) {
                  <span class="block">{{ error }}</span>
                }
              } @else {
                @if (usuarioForm.get('name')?.errors?.['required']) {
                  El nombre es requerido
                }
                @if (usuarioForm.get('name')?.errors?.['minlength']) {
                  El nombre debe tener al menos 2 caracteres
                }
              }
            </small>
          }
        </div>

        <!-- Email -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Correo Electrónico *
          </label>
          <input
            type="email"
            pInputText
            formControlName="email"
            placeholder="Ingrese el correo electrónico"
            class="w-full"
            [class.ng-invalid]="(usuarioForm.get('email')?.invalid && usuarioForm.get('email')?.touched) || validationErrors?.['email']"
          />
          @if ((usuarioForm.get('email')?.invalid && usuarioForm.get('email')?.touched) || validationErrors?.['email']) {
            <small class="text-red-500 text-sm mt-1 block">
              @if (validationErrors?.['email']) {
                @for (error of validationErrors!['email']; track error) {
                  <span class="block">{{ error }}</span>
                }
              } @else {
                @if (usuarioForm.get('email')?.errors?.['required']) {
                  El correo electrónico es requerido
                }
                @if (usuarioForm.get('email')?.errors?.['email']) {
                  Ingrese un correo electrónico válido
                }
              }
            </small>
          }
        </div>

        <!-- Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Contraseña *
          </label>
          <p-password
            formControlName="password"
            placeholder="Ingrese la contraseña"
            [feedback]="false"
            [toggleMask]="true"
            styleClass="w-full"
            inputStyleClass="w-full"
            [class.ng-invalid]="(usuarioForm.get('password')?.invalid && usuarioForm.get('password')?.touched) || validationErrors?.['password']"
          ></p-password>
          @if ((usuarioForm.get('password')?.invalid && usuarioForm.get('password')?.touched) || validationErrors?.['password']) {
            <small class="text-red-500 text-sm mt-1 block">
              @if (validationErrors?.['password']) {
                @for (error of validationErrors!['password']; track error) {
                  <span class="block">{{ error }}</span>
                }
              } @else {
                @if (usuarioForm.get('password')?.errors?.['required']) {
                  La contraseña es requerida
                }
                @if (usuarioForm.get('password')?.errors?.['minlength']) {
                  La contraseña debe tener al menos 6 caracteres
                }
              }
            </small>
          }
        </div>

        <!-- Confirmar Password -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Confirmar Contraseña *
          </label>
          <p-password
            formControlName="password_confirmation"
            placeholder="Confirme la contraseña"
            [feedback]="false"
            [toggleMask]="true"
            styleClass="w-full"
            inputStyleClass="w-full"
            [class.ng-invalid]="(usuarioForm.get('password_confirmation')?.invalid && usuarioForm.get('password_confirmation')?.touched) || validationErrors?.['password_confirmation']"
          ></p-password>
          @if ((usuarioForm.get('password_confirmation')?.invalid && usuarioForm.get('password_confirmation')?.touched) || usuarioForm.errors?.['passwordMismatch'] || validationErrors?.['password_confirmation']) {
            <small class="text-red-500 text-sm mt-1 block">
              @if (validationErrors?.['password_confirmation']) {
                @for (error of validationErrors!['password_confirmation']; track error) {
                  <span class="block">{{ error }}</span>
                }
              } @else if (usuarioForm.errors?.['passwordMismatch'] && usuarioForm.get('password_confirmation')?.touched) {
                Las contraseñas no coinciden
              } @else {
                @if (usuarioForm.get('password_confirmation')?.errors?.['required']) {
                  La confirmación de contraseña es requerida
                }
              }
            </small>
          }
        </div>

      </div>

      <!-- Error Message -->
      @if (error()) {
        <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mt-6">
          {{ error() }}
        </div>
      }

      <!-- Submit Button -->
      <div class="flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
        <button
          [routerLink]="['/usuarios']"
          pButton
          type="button"
          label="Cancelar"
          severity="secondary"
          [disabled]="loading()"
        ></button>
        <button
          pButton
          type="submit"
          label="Crear Usuario"
          icon="pi pi-save"
          [disabled]="usuarioForm.invalid || loading()"
          [loading]="loading()"
        ></button>
      </div>
    </form>
  </div>
</div>
<p-toast position="bottom-right" key="br" />