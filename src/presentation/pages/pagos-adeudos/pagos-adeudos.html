<div class="max-w-8xl mx-auto p-6 bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Pagos de Adeudos</h1>
        <p class="text-gray-600 text-sm mt-1">
          Visualizar todos los pagos realizados
        </p>
      </div>
      <div>
        <button
          pButton
          type="button"
          icon="fa-solid fa-file-excel"
          label="Exportar a excel"
          (click)="exportToExcel()"
        ></button>
      </div>
    </div>
  </div>

  <!-- Search -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <h3
      class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200"
    >
      Filtros
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
      <!-- Search -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Buscar</label
        >
        <span class="p-input-icon-left w-full">
          <i class="pi pi-search"></i>
          <input
            type="text"
            pInputText
            placeholder="Folio, estudiante, concepto..."
            (input)="onSearch($event)"
            class="w-full"
          />
        </span>
      </div>

      <!-- Status Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Estado</label
        >
        <p-select
          [(ngModel)]="selectedEstado"
          (ngModelChange)="onEstadoChange()"
          [options]="estadoOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Todos los estados"
          class="w-full"
        ></p-select>
      </div>

      <!-- Modality Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Modalidad</label
        >
        <p-select
          [(ngModel)]="selectedModalidad"
          (ngModelChange)="onModalidadChange()"
          [options]="modalidadOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Todas"
          class="w-full"
        ></p-select>
      </div>

      <!-- Level Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Nivel</label
        >
        <p-select
          [(ngModel)]="selectedNivel"
          (ngModelChange)="onNivelChange()"
          [options]="nivelOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Todos"
          class="w-full"
        ></p-select>
      </div>

      <!-- Grade Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Grado</label
        >
        <p-select
          [(ngModel)]="selectedGrado"
          (ngModelChange)="onGradoChange()"
          [options]="gradoOptionsForSelect"
          optionLabel="label"
          optionValue="value"
          placeholder="Todos"
          [disabled]="!selectedNivel"
          class="w-full"
        ></p-select>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  @if (error()) {
  <div
    class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6"
  >
    {{ error() }}
  </div>
  }

  <!-- Pagos Table -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <div class="p-6 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">
        Lista de Pagos de Adeudos ({{ filteredPagosAdeudos.length }})
      </h3>
    </div>

    <p-table
      [value]="filteredPagosAdeudos"
      [loading]="loading()"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} - {last} de {totalRecords} pagos"
      styleClass="p-datatable-striped"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="folio" class="text-left">
            Folio <p-sortIcon field="folio"></p-sortIcon>
          </th>
          <th pSortableColumn="folio" class="text-left">
            Estudiante <p-sortIcon field="folio"></p-sortIcon>
          </th>
          <th pSortableColumn="folio" class="text-left">
            Concepto <p-sortIcon field="folio"></p-sortIcon>
          </th>
          <th pSortableColumn="metodoPago" class="text-left">
            Método <p-sortIcon field="metodoPago"></p-sortIcon>
          </th>
          <th pSortableColumn="monto" class="text-right">
            Monto <p-sortIcon field="monto"></p-sortIcon>
          </th>
          <th pSortableColumn="montoTotal" class="text-right">
            Total Adeudo <p-sortIcon field="montoTotal"></p-sortIcon>
          </th>
          <th pSortableColumn="fecha" class="text-center">
            Fecha pago<p-sortIcon field="fecha"></p-sortIcon>
          </th>
          <th pSortableColumn="fechaVencimiento" class="text-center">
            Vencimiento <p-sortIcon field="fechaVencimiento"></p-sortIcon>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-pagoAdeudo>
        <tr>
          <td class="font-medium text-gray-900">{{ pagoAdeudo.folio }}</td>
          <td class="font-medium text-gray-900">
            <div>{{ pagoAdeudo.nombreCompleto }}</div>
            <div class="text-sm text-gray-500">
              {{ pagoAdeudo.nivel }} - {{ pagoAdeudo.grado }}° -
              {{ pagoAdeudo.modalidad }}
            </div>
          </td>
          <td class="font-medium text-gray-900">{{ pagoAdeudo.concepto }}</td>
          <td>
            <p-tag
              [value]="
                pagoAdeudo.metodoPago === 'efectivo'
                  ? 'Efectivo'
                  : 'Transferencia'
              "
              [severity]="
                pagoAdeudo.metodoPago === 'efectivo' ? 'info' : 'success'
              "
            ></p-tag>
          </td>
          <td class="text-right font-semibold text-green-600">
            ${{ pagoAdeudo.monto | number : "1.2-2" }}
          </td>
          <td class="text-right font-semibold text-blue-600">
            ${{ pagoAdeudo.montoTotal | number : "1.2-2" }}
          </td>
          <td class="text-center text-sm">
            {{ pagoAdeudo.fecha | date : "dd/MM/yyyy" }}
          </td>
          <td class="text-center text-sm">
            {{ pagoAdeudo.fechaVencimiento | date : "dd/MM/yyyy" }}
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center py-8">
            <div class="flex flex-col items-center">
              <i class="pi pi-credit-card text-4xl text-gray-400 mb-3"></i>
              <p class="text-lg text-gray-500">No hay pagos que mostrar</p>
              <p class="text-sm text-gray-400">
                Los pagos de adeudos aparecerán aquí cuando se carguen desde el
                servidor
              </p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
