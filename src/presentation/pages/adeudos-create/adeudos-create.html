<div class="max-w-3xl mx-auto p-6 bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Generar Adeudos</h1>
        <p class="text-gray-600 text-sm mt-1">
          Crear adeudos para el ciclo escolar
        </p>
      </div>
      <button
        pButton
        type="button"
        label="Volver"
        icon="pi pi-arrow-left"
        class="p-button-outlined p-button-secondary"
        (click)="volver()"
      ></button>
    </div>
  </div>

  <!-- Cycle Information -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <h3
      class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b border-gray-200"
    >
      Información del Ciclo
    </h3>

    @if (selectedCicloEscolar()) {
    <div class="mb-4">
      <div class="text-lg font-medium text-blue-600 mb-3">
        Ciclo Escolar: {{ selectedCicloEscolar()?.nombre }}
      </div>
      <div class="text-sm text-gray-600">
        <span class="font-medium">Período:</span> 
        {{ selectedCicloEscolar()?.fechaInicio | date:'dd/MM/yyyy' }} - {{ selectedCicloEscolar()?.fechaFin | date:'dd/MM/yyyy' }}
      </div>
      <div class="text-sm text-gray-600 mt-1">
        <span class="font-medium">Estado:</span> 
        <span [class]="selectedCicloEscolar()?.estado === 'activo' ? 'text-green-600' : 'text-gray-500'">
          {{ selectedCicloEscolar()?.estado || 'No definido' }}
        </span>
      </div>
    </div>
    } @else {
    <div class="mb-4">
      <div class="text-lg font-medium text-gray-500 mb-3">
        Ciclo Escolar: Por seleccionar
      </div>
      <div class="text-sm text-gray-500">
        Selecciona un ciclo escolar para ver los detalles
      </div>
    </div>
    }

    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
      <p class="font-medium text-blue-900 mb-3">
        Se generarán adeudos para estudiantes activos con las siguientes
        características:
      </p>
      <ul class="space-y-2 text-blue-800">
        <li class="flex items-start gap-2">
          <i class="pi pi-check text-blue-600 mt-0.5"></i>
          <span>Estudiantes del ciclo escolar, nivel y modalidad seleccionados</span>
        </li>
        <li class="flex items-start gap-2">
          <i class="pi pi-check text-blue-600 mt-0.5"></i>
          <span>Para conceptos de pago semestral y únicos aplicables</span>
        </li>
        <li class="flex items-start gap-2">
          <i class="pi pi-check text-blue-600 mt-0.5"></i>
          <span>Durante los períodos establecidos:</span>
        </li>
      </ul>

      <div class="mt-4 ml-6 space-y-3 text-sm text-blue-700">
        @if (selectedCicloEscolar()) {
        <div>
          <p class="font-medium mb-2">Pagos Semestrales:</p>
          <div class="ml-2 space-y-1">
            <div class="flex justify-between">
              <span>• Primer semestre:</span>
              <span>
                {{ getYearFromDate(selectedCicloEscolar()?.fechaInicio) }}-08-01 → {{ getYearFromDate(selectedCicloEscolar()?.fechaInicio) }}-08-15
              </span>
            </div>
            <div class="flex justify-between">
              <span>• Segundo semestre:</span>
              <span>
                {{ getYearFromDate(selectedCicloEscolar()?.fechaFin) }}-02-01 → {{ getYearFromDate(selectedCicloEscolar()?.fechaFin) }}-02-28
              </span>
            </div>
          </div>
        </div>
        <div>
          <p class="font-medium mb-2">Pagos Únicos:</p>
          <div class="ml-2">
            <div class="flex justify-between">
              <span>• Todo el ciclo escolar:</span>
              <span>
                {{ selectedCicloEscolar()?.fechaInicio | date:'dd/MM/yyyy' }} → {{ selectedCicloEscolar()?.fechaFin | date:'dd/MM/yyyy' }}
              </span>
            </div>
          </div>
        </div>
        } @else {
        <div>
          <p class="font-medium mb-2">Pagos Semestrales:</p>
          <div class="ml-2 space-y-1">
            <div class="flex justify-between">
              <span>• Primer semestre:</span>
              <span>XXXX-08-01 → XXXX-08-15</span>
            </div>
            <div class="flex justify-between">
              <span>• Segundo semestre:</span>
              <span>XXXX-02-01 → XXXX-02-28</span>
            </div>
          </div>
        </div>
        <div>
          <p class="font-medium mb-2">Pagos Únicos:</p>
          <div class="ml-2">
            <div class="flex justify-between">
              <span>• Todo el ciclo escolar:</span>
              <span>Selecciona un ciclo escolar</span>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>

  <!-- Form -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <h3
      class="text-lg font-semibold text-gray-900 mb-6 pb-2 border-b border-gray-200"
    >
      Configuración
    </h3>

    <form [formGroup]="adeudosGenerarForm" (ngSubmit)="onSubmit()">
      <div class="grid md:grid-cols-3 gap-4">
        <!-- Ciclo Escolar Selection -->
        <div>
          <label for="ciclo_escolar_id" class="block text-sm font-medium text-gray-700 mb-2">
            Ciclo Escolar <span class="text-red-500">*</span>
          </label>
          <p-select
            inputId="ciclo_escolar_id"
            formControlName="ciclo_escolar_id"
            [options]="ciclosEscolares"
            optionLabel="nombre"
            optionValue="id"
            placeholder="Selecciona un ciclo escolar"
            [loading]="ciclosLoading"
            class="w-full"
            (onChange)="onCicloEscolarChange($event)"
          ></p-select>
          @if (isInvalid('ciclo_escolar_id')) {
          <small class="text-red-600 text-xs mt-1 block"
            >El ciclo escolar es requerido</small
          >
          }
        </div>

        <!-- Nivel Selection -->
        <div>
          <label for="nivel_id" class="block text-sm font-medium text-gray-700 mb-2">
            Nivel <span class="text-red-500">*</span>
          </label>
          <p-select
            inputId="nivel_id"
            formControlName="nivel_id"
            [options]="niveles"
            optionLabel="displayName"
            optionValue="id"
            placeholder="Selecciona un nivel"
            [loading]="nivelesLoading"
            class="w-full"
          ></p-select>
          @if (isInvalid('nivel_id')) {
          <small class="text-red-600 text-xs mt-1 block"
            >El nivel es requerido</small
          >
          }
        </div>

        <!-- Modalidad Selection -->
        <div>
          <label for="modalidad_id" class="block text-sm font-medium text-gray-700 mb-2">
            Modalidad <span class="text-red-500">*</span>
          </label>
          <p-select
            inputId="modalidad_id"
            formControlName="modalidad_id"
            [options]="modalidades"
            optionLabel="displayName"
            optionValue="id"
            placeholder="Selecciona una modalidad"
            [loading]="modalidadesLoading"
            class="w-full"
          ></p-select>
          @if (isInvalid('modalidad_id')) {
          <small class="text-red-600 text-xs mt-1 block"
            >La modalidad es requerida</small
          >
          }
        </div>
      </div>
    </form>
  </div>

  <!-- Actions -->
  <div class="flex justify-end">
    <button
      pButton
      type="submit"
      label="Generar Adeudos"
      icon="pi pi-plus"
      [disabled]="!adeudosGenerarForm.valid || loading"
      [loading]="loading"
      (click)="onSubmit()"
    ></button>
  </div>
</div>
<p-toast position="bottom-right" key="br" />
